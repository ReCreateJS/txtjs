var SVGArc = /** @class */ (function () {
    function SVGArc(x1, rx, ry, phiarg, fA, fS, x2) {
        this.rx = rx;
        this.ry = ry;
        this.x2 = x2;
        if (rx == 0 || ry == 0) {
            return;
        }
        var phi = phiarg * (Math.PI / 180.0);
        rx = Math.abs(rx);
        ry = Math.abs(ry);
        var xPrime = this.rotClockwise(this.midPoint(x1, x2), phi); // F.6.5.1
        var xPrime2 = this.pointMul(xPrime, xPrime);
        var rx2 = Math.pow(rx, 2);
        var ry2 = Math.pow(ry, 2);
        var lambda = Math.sqrt(xPrime2[0] / rx2 + xPrime2[1] / ry2);
        if (lambda > 1) {
            rx *= lambda;
            ry *= lambda;
            rx2 = Math.pow(rx, 2);
            ry2 = Math.pow(ry, 2);
        }
        var t = rx2 * ry2 - rx2 * xPrime2[1] - ry2 * xPrime2[0];
        if (t > -0.000001 && t < 0.000001) {
            t = 0;
        }
        var b = rx2 * xPrime2[1] + ry2 * xPrime2[0];
        if (b > -0.000001 && b < 0.000001) {
            b = 0;
        }
        var factor = Math.sqrt(t / b);
        if (fA == fS) {
            factor *= -1.0;
        }
        var cPrime = this.scale(factor, [
            (rx * xPrime[1]) / ry,
            (-ry * xPrime[0]) / rx
        ]);
        var c = this.sum(this.rotCounterClockwise(cPrime, phi), this.meanVec(x1, x2));
        var x1UnitVector = [
            (xPrime[0] - cPrime[0]) / rx,
            (xPrime[1] - cPrime[1]) / ry
        ];
        var x2UnitVector = [
            (-1.0 * xPrime[0] - cPrime[0]) / rx,
            (-1.0 * xPrime[1] - cPrime[1]) / ry
        ];
        var theta = this.angle([1, 0], x1UnitVector);
        var deltaTheta = this.angle(x1UnitVector, x2UnitVector);
        if (isNaN(deltaTheta)) {
            deltaTheta = Math.PI;
        }
        var start = theta;
        var end = theta + deltaTheta;
        this.cx = c[0];
        this.cy = c[1];
        this.phi = phi;
        this.rx = rx;
        this.ry = ry;
        this.start = start;
        this.end = end;
        this.fS = !fS;
    }
    SVGArc.prototype.mag = function (v) {
        return Math.sqrt(Math.pow(v[0], 2) + Math.pow(v[1], 2));
    };
    SVGArc.prototype.meanVec = function (u, v) {
        return [(u[0] + v[0]) / 2.0, (u[1] + v[1]) / 2.0];
    };
    SVGArc.prototype.dot = function (u, v) {
        return u[0] * v[0] + u[1] * v[1];
    };
    SVGArc.prototype.ratio = function (u, v) {
        return this.dot(u, v) / (this.mag(u) * this.mag(v));
    };
    SVGArc.prototype.rotClockwise = function (v, angle) {
        var cost = Math.cos(angle);
        var sint = Math.sin(angle);
        return [cost * v[0] + sint * v[1], -1 * sint * v[0] + cost * v[1]];
    };
    SVGArc.prototype.pointMul = function (u, v) {
        return [u[0] * v[0], u[1] * v[1]];
    };
    SVGArc.prototype.scale = function (c, v) {
        return [c * v[0], c * v[1]];
    };
    SVGArc.prototype.sum = function (u, v) {
        return [u[0] + v[0], u[1] + v[1]];
    };
    SVGArc.prototype.angle = function (u, v) {
        var sign = 1.0;
        if (u[0] * v[1] - u[1] * v[0] < 0) {
            sign = -1.0;
        }
        return sign * Math.acos(this.ratio(u, v));
    };
    SVGArc.prototype.rotCounterClockwise = function (v, angle) {
        var cost = Math.cos(angle);
        var sint = Math.sin(angle);
        return [cost * v[0] - sint * v[1], sint * v[0] + cost * v[1]];
    };
    SVGArc.prototype.midPoint = function (u, v) {
        return [(u[0] - v[0]) / 2.0, (u[1] - v[1]) / 2.0];
    };
    SVGArc.prototype.exec = function (ctx) {
        if (this.rx == 0 || this.ry == 0) {
            ctx.lineTo(this.x2[0], this.x2[1]);
            return;
        }
        ctx.translate(this.cx, this.cy);
        ctx.rotate(this.phi);
        ctx.scale(this.rx, this.ry);
        ctx.arc(0, 0, 1, this.start, this.end, this.fS);
        ctx.scale(1 / this.rx, 1 / this.ry);
        ctx.rotate(-this.phi);
        ctx.translate(-this.cx, -this.cy);
    };
    return SVGArc;
}());
export default SVGArc;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU1ZHQXJjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL1NWR0FyYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtJQWlFRSxnQkFDRSxFQUFZLEVBQ1osRUFBVSxFQUNWLEVBQVUsRUFDVixNQUFjLEVBQ2QsRUFBVyxFQUNYLEVBQVcsRUFDWCxFQUFZO1FBRVosSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztRQUNiLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQ2IsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUU7WUFDdEIsT0FBTztTQUNSO1FBQ0QsSUFBTSxHQUFHLEdBQUcsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUMsQ0FBQztRQUN2QyxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQixFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQixJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsVUFBVTtRQUN4RSxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUM5QyxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMxQixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUUxQixJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENB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RUQscUJBQUksR0FBSixVQUFLLEdBQTZCO1FBQ2hDLElBQUksSUFBSSxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLEVBQUUsSUFBSSxDQUFDLEVBQUU7WUFDaEMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuQyxPQUFPO1NBQ1I7UUFDRCxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2hDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDNUIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2hELEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFDSCxhQUFDO0FBQUQsQ0FBQyxBQXpKRCxJQXlKQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNWR0FyYyB7XG4gIHIwOiBudW1iZXI7XG4gIHIxOiBudW1iZXI7XG4gIGN4OiBudW1iZXI7XG4gIGN5OiBudW1iZXI7XG4gIHBoaTogbnVtYmVyO1xuICByeDogbnVtYmVyO1xuICByeTogbnVtYmVyO1xuICBzdGFydDogbnVtYmVyO1xuICBlbmQ6IG51bWJlcjtcbiAgZlM6IGJvb2xlYW47XG4gIHgyOiBudW1iZXJbXTtcblxuICBtYWcodikge1xuICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3codlswXSwgMikgKyBNYXRoLnBvdyh2WzFdLCAyKSk7XG4gIH1cblxuICBtZWFuVmVjKHUsIHYpIHtcbiAgICByZXR1cm4gWyh1WzBdICsgdlswXSkgLyAyLjAsICh1WzFdICsgdlsxXSkgLyAyLjBdO1xuICB9XG5cbiAgZG90KHUsIHYpIHtcbiAgICByZXR1cm4gdVswXSAqIHZbMF0gKyB1WzFdICogdlsxXTtcbiAgfVxuXG4gIHJhdGlvKHUsIHYpIHtcbiAgICByZXR1cm4gdGhpcy5kb3QodSwgdikgLyAodGhpcy5tYWcodSkgKiB0aGlzLm1hZyh2KSk7XG4gIH1cblxuICByb3RDbG9ja3dpc2UodiwgYW5nbGUpIHtcbiAgICBjb25zdCBjb3N0ID0gTWF0aC5jb3MoYW5nbGUpO1xuICAgIGNvbnN0IHNpbnQgPSBNYXRoLnNpbihhbmdsZSk7XG4gICAgcmV0dXJuIFtjb3N0ICogdlswXSArIHNpbnQgKiB2WzFdLCAtMSAqIHNpbnQgKiB2WzBdICsgY29zdCAqIHZbMV1dO1xuICB9XG5cbiAgcG9pbnRNdWwodSwgdikge1xuICAgIHJldHVybiBbdVswXSAqIHZbMF0sIHVbMV0gKiB2WzFdXTtcbiAgfVxuXG4gIHNjYWxlKGMsIHYpIHtcbiAgICByZXR1cm4gW2MgKiB2WzBdLCBjICogdlsxXV07XG4gIH1cblxuICBzdW0odSwgdikge1xuICAgIHJldHVybiBbdVswXSArIHZbMF0sIHVbMV0gKyB2WzFdXTtcbiAgfVxuXG4gIGFuZ2xlKHUsIHYpIHtcbiAgICBsZXQgc2lnbiA9IDEuMDtcbiAgICBpZiAodVswXSAqIHZbMV0gLSB1WzFdICogdlswXSA8IDApIHtcbiAgICAgIHNpZ24gPSAtMS4wO1xuICAgIH1cbiAgICByZXR1cm4gc2lnbiAqIE1hdGguYWNvcyh0aGlzLnJhdGlvKHUsIHYpKTtcbiAgfVxuXG4gIHJvdENvdW50ZXJDbG9ja3dpc2UodiwgYW5nbGUpIHtcbiAgICBjb25zdCBjb3N0ID0gTWF0aC5jb3MoYW5nbGUpO1xuICAgIGNvbnN0IHNpbnQgPSBNYXRoLnNpbihhbmdsZSk7XG4gICAgcmV0dXJuIFtjb3N0ICogdlswXSAtIHNpbnQgKiB2WzFdLCBzaW50ICogdlswXSArIGNvc3QgKiB2WzFdXTtcbiAgfVxuXG4gIG1pZFBvaW50KHUsIHYpIHtcbiAgICByZXR1cm4gWyh1WzBdIC0gdlswXSkgLyAyLjAsICh1WzFdIC0gdlsxXSkgLyAyLjBdO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgeDE6IG51bWJlcltdLFxuICAgIHJ4OiBudW1iZXIsXG4gICAgcnk6IG51bWJlcixcbiAgICBwaGlhcmc6IG51bWJlcixcbiAgICBmQTogYm9vbGVhbixcbiAgICBmUzogYm9vbGVhbixcbiAgICB4MjogbnVtYmVyW11cbiAgKSB7XG4gICAgdGhpcy5yeCA9IHJ4O1xuICAgIHRoaXMucnkgPSByeTtcbiAgICB0aGlzLngyID0geDI7XG4gICAgaWYgKHJ4ID09IDAgfHwgcnkgPT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBwaGkgPSBwaGlhcmcgKiAoTWF0aC5QSSAvIDE4MC4wKTtcbiAgICByeCA9IE1hdGguYWJzKHJ4KTtcbiAgICByeSA9IE1hdGguYWJzKHJ5KTtcbiAgICBjb25zdCB4UHJpbWUgPSB0aGlzLnJvdENsb2Nrd2lzZSh0aGlzLm1pZFBvaW50KHgxLCB4MiksIHBoaSk7IC8vIEYuNi41LjFcbiAgICBjb25zdCB4UHJpbWUyID0gdGhpcy5wb2ludE11bCh4UHJpbWUsIHhQcmltZSk7XG4gICAgbGV0IHJ4MiA9IE1hdGgucG93KHJ4LCAyKTtcbiAgICBsZXQgcnkyID0gTWF0aC5wb3cocnksIDIpO1xuXG4gICAgY29uc3QgbGFtYmRhID0gTWF0aC5zcXJ0KHhQcmltZTJbMF0gLyByeDIgKyB4UHJpbWUyWzFdIC8gcnkyKTtcbiAgICBpZiAobGFtYmRhID4gMSkge1xuICAgICAgcnggKj0gbGFtYmRhO1xuICAgICAgcnkgKj0gbGFtYmRhO1xuICAgICAgcngyID0gTWF0aC5wb3cocngsIDIpO1xuICAgICAgcnkyID0gTWF0aC5wb3cocnksIDIpO1xuICAgIH1cbiAgICBsZXQgdCA9IHJ4MiAqIHJ5MiAtIHJ4MiAqIHhQcmltZTJbMV0gLSByeTIgKiB4UHJpbWUyWzBdO1xuICAgIGlmICh0ID4gLTAuMDAwMDAxICYmIHQgPCAwLjAwMDAwMSkge1xuICAgICAgdCA9IDA7XG4gICAgfVxuICAgIGxldCBiID0gcngyICogeFByaW1lMlsxXSArIHJ5MiAqIHhQcmltZTJbMF07XG4gICAgaWYgKGIgPiAtMC4wMDAwMDEgJiYgYiA8IDAuMDAwMDAxKSB7XG4gICAgICBiID0gMDtcbiAgICB9XG4gICAgbGV0IGZhY3RvciA9IE1hdGguc3FydCh0IC8gYik7XG4gICAgaWYgKGZBID09IGZTKSB7XG4gICAgICBmYWN0b3IgKj0gLTEuMDtcbiAgICB9XG4gICAgY29uc3QgY1ByaW1lID0gdGhpcy5zY2FsZShmYWN0b3IsIFtcbiAgICAgIChyeCAqIHhQcmltZVsxXSkgLyByeSxcbiAgICAgICgtcnkgKiB4UHJpbWVbMF0pIC8gcnhcbiAgICBdKTtcbiAgICBjb25zdCBjID0gdGhpcy5zdW0oXG4gICAgICB0aGlzLnJvdENvdW50ZXJDbG9ja3dpc2UoY1ByaW1lLCBwaGkpLFxuICAgICAgdGhpcy5tZWFuVmVjKHgxLCB4MilcbiAgICApO1xuICAgIGNvbnN0IHgxVW5pdFZlY3RvciA9IFtcbiAgICAgICh4UHJpbWVbMF0gLSBjUHJpbWVbMF0pIC8gcngsXG4gICAgICAoeFByaW1lWzFdIC0gY1ByaW1lWzFdKSAvIHJ5XG4gICAgXTtcbiAgICBjb25zdCB4MlVuaXRWZWN0b3IgPSBbXG4gICAgICAoLTEuMCAqIHhQcmltZVswXSAtIGNQcmltZVswXSkgLyByeCxcbiAgICAgICgtMS4wICogeFByaW1lWzFdIC0gY1ByaW1lWzFdKSAvIHJ5XG4gICAgXTtcbiAgICBjb25zdCB0aGV0YSA9IHRoaXMuYW5nbGUoWzEsIDBdLCB4MVVuaXRWZWN0b3IpO1xuICAgIGxldCBkZWx0YVRoZXRhID0gdGhpcy5hbmdsZSh4MVVuaXRWZWN0b3IsIHgyVW5pdFZlY3Rvcik7XG4gICAgaWYgKGlzTmFOKGRlbHRhVGhldGEpKSB7XG4gICAgICBkZWx0YVRoZXRhID0gTWF0aC5QSTtcbiAgICB9XG4gICAgY29uc3Qgc3RhcnQgPSB0aGV0YTtcbiAgICBjb25zdCBlbmQgPSB0aGV0YSArIGRlbHRhVGhldGE7XG4gICAgdGhpcy5jeCA9IGNbMF07XG4gICAgdGhpcy5jeSA9IGNbMV07XG4gICAgdGhpcy5waGkgPSBwaGk7XG4gICAgdGhpcy5yeCA9IHJ4O1xuICAgIHRoaXMucnkgPSByeTtcbiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7XG4gICAgdGhpcy5lbmQgPSBlbmQ7XG4gICAgdGhpcy5mUyA9ICFmUztcbiAgfVxuXG4gIGV4ZWMoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpIHtcbiAgICBpZiAodGhpcy5yeCA9PSAwIHx8IHRoaXMucnkgPT0gMCkge1xuICAgICAgY3R4LmxpbmVUbyh0aGlzLngyWzBdLCB0aGlzLngyWzFdKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY3R4LnRyYW5zbGF0ZSh0aGlzLmN4LCB0aGlzLmN5KTtcbiAgICBjdHgucm90YXRlKHRoaXMucGhpKTtcbiAgICBjdHguc2NhbGUodGhpcy5yeCwgdGhpcy5yeSk7XG4gICAgY3R4LmFyYygwLCAwLCAxLCB0aGlzLnN0YXJ0LCB0aGlzLmVuZCwgdGhpcy5mUyk7XG4gICAgY3R4LnNjYWxlKDEgLyB0aGlzLnJ4LCAxIC8gdGhpcy5yeSk7XG4gICAgY3R4LnJvdGF0ZSgtdGhpcy5waGkpO1xuICAgIGN0eC50cmFuc2xhdGUoLXRoaXMuY3gsIC10aGlzLmN5KTtcbiAgfVxufVxuIl19